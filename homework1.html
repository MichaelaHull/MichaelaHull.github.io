<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Homework 1</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <style type="text/css">

.axis path,

.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
    width: 1px;
}

.axis text {
    font-family: sans-serif;
    font-size: 10px;
}
.d3-tip {
  line-height: 1;
  padding: 12px;
/*  background: rgba(0, 0, 0, 0.8);*/
  color: #fff;
  border-radius: 2px;
  font-size: 20px;
}

/* Creates a small triangle extender for the tooltip
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  text-align: center;
}
*/

</style>
</head>
<h1>Letter Frequency</h1>
<body align="center">
<script>

/* FUNCTIONS */
function letter_count(word){
    var letters = {};
    var letter;
    for (letter in word){
        if (letters[word[letter]] === undefined) {
            letters[word[letter]] = 1
        }
        else {
            letters[word[letter]] = letters[word[letter]] + 1
        }
    };
    return letters
};

/* VARIABLES */

var duration = 1000;

var colors = {
    "grey":   "#bbbbbb",
    "blue":   "#377eb8",
    "purple": "#984ea3",
    "green":  "#4daf4a",
    "orange": "#ff7f00"
};

var tip = d3.tip()
    .attr("class", "d3-tip")
    .offset([50, 0])
    .html(function(d) {
        if (+d.height === 1){
            return d.height + " " + d.id;
        }
        else {
            return d.height + " " + d.id + "'s";
        }
    });

/* svg variables */
var svg_width = 600;
var svg_height = 400;
var margin = 50;

var svg = d3.select("body").append("svg");
svg.attr("width", svg_width);
svg.attr("height", svg_height);
svg.style("border-color", colors.grey);
svg.style("border-width", 1);
svg.style("border-style", "solid");
svg.call(tip);

/* plot variables */
var plot_width = svg_width - 2*margin;
var plot_height = svg_height - 2*margin;
var plot = svg.append("g");
plot.attr("transform", "translate(" + margin + "," + margin + ")");

/* Getting the word(s) and letters */
var word_p = decodeURI(location.search)
var word_no_p = word_p.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()?]/g, "");
var word = word_no_p.replace(/\s{2,}/g, "");
word = word.toLowerCase();
console.log("Word:", word);

var word_letters = letter_count(word);
console.log("Letters:", word_letters);
var word_keys = Object.keys(word_letters);
word_keys.sort();
var word_vals = [];
var k;
for (k in word_keys){
    word_vals.push(word_letters[word_keys[k]])
};
console.log("Keys:", word_keys);
console.log("Values", word_vals);
var max_val = Math.max.apply(null, word_vals);
var num_letters = word_keys.length;

/* x, y, height and width variables */
var x = d3.scale.linear()
    .domain([0, num_letters + 0.2])
    .range([0, plot_width]);
var y = d3.scale.linear()
    .domain([0, max_val + 0.5])
    .range([plot_height, 0]);
var height = d3.scale.linear()
    .domain([0, max_val + 0.5])
    .range([0, plot_height]);

var i = 0;

function bar_nums(keys, values) {
    var info = [];
    for (i in values) {
        var d = {};
        d["width"] = 0.8;
        d["height"] = values[i];
        d["x"] = (+ i) + 0.2;
        d["y"] = values[i];
        d["id"] = keys[i];
        info.push(d);
    };
    return info;
}

var box_info = bar_nums(word_keys, word_vals);
console.log("Boxes:", box_info);

var boxes = plot.selectAll("rect")
    .data(box_info, function(d) {
        return d.id;
    })
    .enter();
boxes.append("rect")
    .attr("x", function(d) {return x(d.x); })
    .attr("y", function(d) {return y(d.y); })
    .attr("height", function(d) {return height(d.height); })
    .attr("width", function(d) {return x(d.width); })
    .style("fill", colors.blue)
    .on("mouseover", tip.show)
    //     function(){
    //     d3.select(this)
    //     .transition(duration)
    //     .style("fill", colors.purple);
    // })
    .on("mouseout", tip.hide
    //     function(){
    //     d3.select(this)
    //     .transition(duration)
    //     .style("fill", colors.blue);
    // }
    );

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(4);

var xScale = d3.scale.ordinal()
    .domain(word_keys)
    .rangeRoundBands([0, 100*num_letters]);

var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom")
    .ticks(0);

plot.append("g")
    .attr("class", "y axis")
    .call(yAxis);

plot.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + plot_height + ")")
    .call(xAxis);

/*
Useful:
arr.forEach(function(blah) { print(blah)});

d3.scale().linear().domain().range().nice();
Scales things nicely
*/
</script>
</body>
</html>