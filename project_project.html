<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-quiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewpoint" content="width=device-width, initial-scale=1">

  <title>Final Project</title>
  
  <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
  <link rel="stylesheet" href="stylesheets/main.css">
  <link href="bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
  <script src="http://code.jquery.com/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <script src="javascripts/jquery.tipsy.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="sf_map.js"></script>
  <style type="text/css">
  .brush .extent {
    stroke: #fff;
    fill-opacity: .125;
    shape-rendering: crispEdges;
  }

  .line {
    clip-path: url(#clip);
  }

  .d3-tip {
  line-height: 1;
  padding: 12px;
/*  background: rgba(0, 0, 0, 0.8);*/
  color: #fff;
  border-radius: 2px;
  font-family: sans-serif;
  font-size: 14px;
  }
  </style>
</head>
<body align="center">

<!--NAVIGATIONBAR-->
  <div class="nav">
    <div class="container">
      <div class="row">
        <div class="col-md-0">
        <ul class="pull-left">
          <li><a href="http://MichaelaHull.github.io#homework">Homework</a></li>
          <li><a href="http://MichaelaHull.github.io#projects">Project</a></li>
          <li><a href="http://MichaelaHull.github.io#participation">Participation</a></li>
        </ul>
        </div>
        <div class="col-md-0">
        <ul class="pull-right">
          <li><a href="http://MichaelaHull.github.io#about">About</a></li>
          <li><a href="http://MichaelaHull.github.io#contact">Contact</a></li>
          <li><a href="http://MichaelaHull.github.io">Home</a></li>
        </ul>
        </div>
      </div>
    </div>
  </div>

<!--BANNER-->
  <div class="banner">
    <div class="container">
      <h1>Michaela Hull, Final Project: <strong>SFPD Incidents in October 2014</strong></h1>
      <ul class="pull-right">
        <li><a href="https://data.sfgov.org/Public-Safety/SFPD-Incidents-from-1-January-2003/tmnf-yvry">Source Data</a></li>
        <li><a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/project_project.html">Code</a></li>
        <li><a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/data_files/sfpd_incidents_2014.csv">Data</a></li>
      </ul>
    </div>
  </div>
<div class="section">
<div class="container">
<p id="log">Fetching data... Please wait</p>
<div id="filter"><b>Neighborhoods: </b></div>
<script type="text/javascript">

  function wrap(text, width) {
    text.each(function() {
      var text = d3.select(this),
          words = text.text().split(/\s+/).reverse(),
          word,
          line = [],
          lineNumber = 0,
          lineHeight = 1.1, // ems
          y = text.attr("y"),
          dy = 12, //parseFloat(text.attr("dy")),
          tspan = text.text(null).append("tspan").attr("x", width / 2).attr("y", y).attr("dy", dy + "em");
      while (word = words.pop()) {
        line.push(word);
        tspan.text(line.join(" "));
        if (tspan.node().getComputedTextLength() > width) {
          line.pop();
          tspan.text(line.join(" "));
          line = [word];
          tspan = text.append("tspan").attr("x", width / 2).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
        }
      }
    });
  }

  function mouseOn() { 
    var circle = d3.select(this);
    circle.transition(duration)
      .attr("r", 10);
    circle.append("g")
      .append("text")
      .attr("class", "hovertext")
      .attr("y", d3.mouse(this)[1])
      .attr("x", d3.mouse(this)[0])
      .text(function (d, i) { return d.gen_cat; });

  // function to move mouseover item to front of SVG stage, in case
  // another bubble overlaps it
    d3.selection.prototype.moveToFront = function() { 
      return this.each(function() { 
      this.parentNode.appendChild(this); 
      }); 
    };

  // skip this functionality for IE9, which doesn't like it
    if (!$.browser.msie) {
      circle.moveToFront(); 
      }
  };

  var mouseOff = function() {
    var circle = d3.select(this);

    // go back to original size and opacity
    circle.transition(duration)
      .attr("r", 3);

    // fade out guide lines, then remove them
  };

  var baseURL = "https://gist.githubusercontent.com/mbostock/4090846/raw/"

  var svg_ts_height = 400;
  var svg_ts_width = 900;
  var margin = 30;
  var lab_margin = 80;
  var svg_crime_height = 250;
  var svg_crime_width = svg_ts_width/2;
  var svg_hood_height = svg_crime_height;
  var svg_hood_width = svg_crime_width;
  var svg_brush_height = 100;
  var svg_brush_width = svg_ts_width;
  var svg_smallmap_width = 120;
  var svg_smallmap_height = 100;
  var svg_map_height = 500;
  var svg_map_width = 650;
  var svg_mapfilter_height = svg_map_height;
  var svg_mapfilter_width = svg_ts_width - svg_map_width;
  var svg_smallmult_height = svg_map_height;
  var svg_smallmult_width = 245;

  var plot_ts_height = svg_ts_height - 2*margin;
  var plot_ts_width = svg_ts_width - margin - lab_margin;
  var plot_crime_height = svg_crime_height - 2*margin;
  var plot_crime_width = svg_crime_width - 2*lab_margin - margin;
  var plot_hood_height = svg_hood_height - 2*margin;
  var plot_hood_width = svg_hood_width - lab_margin - margin;
  var plot_brush_height = svg_brush_height - 2*margin;
  var plot_brush_width = plot_ts_width;

  var duration = 300;

  // var map_theft = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  // var map_other = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  // var map_vandalism = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  // var map_assault = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  // var map_controlled = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  // var map_kidnapping = d3.select("body").append("svg")
  //   .attr("height", svg_smallmap_height)
  //   .attr("width", svg_smallmap_width);

  var svg_map = d3.select("body").append("svg")
    .attr("height", svg_map_height)
    .attr("width", svg_map_width);

  var svg_smallmult = d3.select("body").append("svg")
    .attr("height", svg_smallmult_height)
    .attr("width", svg_smallmult_width);

  var map_theft = svg_smallmult.append("g")
    .attr("transform", "translate(" + (0 * (svg_smallmap_width + 15)) + "," + (0 * (svg_smallmap_height + 15) + 80) + ")");

  var map_other = svg_smallmult.append("g")
    .attr("transform", "translate(" + (1 * (svg_smallmap_width + 15)) + "," + (0 * (svg_smallmap_height + 15) + 80) + ")");

  var map_vandalism = svg_smallmult.append("g")
    .attr("transform", "translate(" + (0 * (svg_smallmap_width + 15)) + "," + (1 * (svg_smallmap_height + 15) + 80) + ")");

  var map_assault = svg_smallmult.append("g")
    .attr("transform", "translate(" + (1 * (svg_smallmap_width + 15)) + "," + (1 * (svg_smallmap_height + 15) + 80) + ")");

  var map_controlled = svg_smallmult.append("g")
    .attr("transform", "translate(" + (0 * (svg_smallmap_width + 15)) + "," + (2 * (svg_smallmap_height + 15) + 80) + ")");

  var map_kidnapping = svg_smallmult.append("g")
    .attr("transform", "translate(" + (1 * (svg_smallmap_width + 15)) + "," + (2 * (svg_smallmap_height + 15) + 80) + ")");

  // var svg_filter = d3.select("body").append("svg")
  //   .attr("height", svg_mapfilter_height)
  //   .attr("width", svg_mapfilter_width);

  var svg_crime = d3.select("body").append("svg")
    .attr("height", svg_crime_height)
    .attr("width", svg_crime_width);

  var plot_crime = svg_crime.append("g")
    .attr("transform", "translate(" + 2*lab_margin + "," + margin + ")");

  var svg_hood = d3.select("body").append("svg")
    .attr("height", svg_hood_height)
    .attr("width", svg_hood_width);

  var plot_hood = svg_hood.append("g")
    .attr("transform", "translate(" + lab_margin + "," + margin + ")");

  var svg_ts = d3.select("body").append("svg")
    .attr("height", svg_ts_height)
    .attr("width", svg_ts_width);
  svg_ts.append("defs").append("clipPath")
    .attr("id", "clip")
    .append("rect")
    .attr("width", plot_ts_width)
    .attr("height", plot_ts_height);

  var plot_ts = svg_ts.append("g")
    .attr("transform", "translate(" + lab_margin + "," + margin + ")");

  var svg_brush = d3.select("body").append("svg")
    .attr("height", svg_brush_height)
    .attr("width", svg_brush_width);

  var plot_brush = svg_brush.append("g")
    .attr("transform", "translate(" + lab_margin + "," + margin + ")");

  var districts = ["Southern", "Northern", "Mission", "Central", "Ingleside", "Bayview", "Tenderloin", "Taraval", "Park", "Richmond"];
  var sorted_districts = ["Bayview", "Central", "Ingleside", "Mission", "Northern", "Park", "Richmond", "Southern", "Taraval", "Tenderloin"]
  var crimes = ["Theft", "Other", "Vandalism", "Assault", "Controlled", "Kidnapping"];
  var crime_names = ["Theft", "Other", "Disorderly Conduct", "Violent Crime", "Controlled Substances/Items", "Kidnapping"];
  var crime_name_dict = {
    "Theft": "Theft",
    "Other": "Other",
    "Vandalism": "Vandalism/disorderly conduct",
    "Assault": "Assault/violent crime",
    "Controlled": "Controlled substances/items",
    "Kidnapping": "Kidnapping/missing persons"
  };

  var crime_dict = [];
  var district_dict = [];

  function count_start(keys, dict, thing, otherthings) {
    var k;
    for (k in keys) {
      var u = {};
      u[thing] = keys[k];
      u["count"] = 0;
      var t;
      for (t in otherthings){
        u[otherthings[t]] = 0
      };
      dict.push(u);
    };
  };

  count_start(districts, district_dict, "district", crimes);
  count_start(crimes, crime_dict, "gen_cat", districts);

  var date_format = d3.time.format("%m/%d/%Y");
  var date_time = d3.time.format("%Y-%m-%d %H:%M:%S");
  var date_output = d3.time.format("%A, %B %d");
  var time_output = d3.time.format("%I %p");

  var color = d3.scale.ordinal()
    .domain(crimes)
    .range(["#e6ab02", "#666666", "#1b9e77", "#e7298a", "#7570b3", "#17becf"]);

  var small_maps = [map_theft, map_other, map_vandalism, map_assault, map_controlled, map_kidnapping];

  var big_projection = d3.geo.mercator()
    .scale(1)
    .translate([0, 0])
    .precision(0);
  var big_path = d3.geo.path()
    .projection(big_projection);

  var small_projection = d3.geo.mercator()
    .scale(1)
    .translate([0, 0])
    .precision(0);
  var small_path = d3.geo.path()
    .projection(small_projection);

  var dropDownNeighbor = d3.select("#filter")
    .append("select")
    .attr("name", "neighbor-list");
  var neighborOptions = dropDownNeighbor.selectAll("option")
    .data(["All"].concat(sorted_districts))
    .enter()
    .append("option");

  neighborOptions.text(function (d) { return d; })
    .attr("value", function (d) { return d; });

  d3.json("data_files/sf_topojson.json", function (mapError, mapData) {
        var log = d3.select("#log");
        log.text("Drawing maps... Please wait");
        var featureCollection = topojson.feature(mapData, mapData.objects.collection);
        var bounds = big_path.bounds(featureCollection);
        
        var big_scale = (svg_map_height - 20) / Math.abs(bounds[1][1] - bounds[0][1]);
        var small_scale = (svg_smallmap_height - 5) / Math.abs(bounds[1][1] - bounds[0][1]);
        var big_trans = [(svg_map_width - big_scale * (bounds[1][0] + bounds[0][0]))/2, (svg_map_height - big_scale * (bounds[1][1] + bounds[0][1]))/2];
        var small_trans = [(svg_smallmap_width - small_scale * (bounds[1][0] + bounds[0][0])) / 2, (svg_smallmap_height - small_scale * (bounds[1][1] + bounds[0][1])) / 2];

        big_projection.scale(big_scale).translate(big_trans);
        small_projection.scale(small_scale).translate(small_trans);

        svg_map.append("path")
            .datum(topojson.feature(mapData, mapData.objects.collection))
            .attr("class", "land")
            .attr("d", big_path)
            .attr("fill", "#DAE3E8");
        // svg_map.append("path")
        //     .datum(topojson.mesh(mapData, mapData.objects.collection, function (a, b) { return a !== b; }))
        //     .attr("class", "boundary")
        //     .attr("d", big_path)
        //     .attr("fill", "none")
        //     .attr("stroke", "white");

        var s;
        for (s in small_maps) {
          small_maps[s].append("path")
            .datum(topojson.feature(mapData, mapData.objects.collection))
            .attr("class", "land")
            .attr("d", small_path)
            .attr("fill", "#DAE3E8");
          // small_maps[s].append("path")
          //   .datum(topojson.mesh(mapData, mapData.objects.collection, function (a, b) { return a !== b; }))
          //   .attr("class", "boundary")
          //   .attr("d", small_path)
          //   .attr("fill", "none")
          //   .attr("stroke", "white");
        };
        log.text("Fetching data... Please wait");

      // var circles = d3.svg.circle()
      //   .interpolate("basis")
      //   .x(function (d, i) { return big_projection([d.X, d.Y])[0]; })
      //   .y(function (d, i) { return big_projection([d.X, d.Y])[1]; })
      //   .r(radius);

      d3.csv("data_files/sfpd_incidents_10_2014.csv", function (dataError, dataData) {
        dataData.forEach(function (d, i) {
          d.IncidntNum = d.IncidntNum;
          d.Category = d.Category;
          d.Descript = d.Descript;
          d.DayOfWeek = d.DayOfWeek;
          d.Date = date_format.parse(d.Date);
          d.Time = d.Time;
          d.PdDistrict = d.PdDistrict;
          d.Resolution = d.Resolution;
          d.X = + d.X;
          d.Y = + d.Y;
          d.gen_cat = d.gen_cat;
          d.datetime = date_time.parse(d.datetime);
          var u = crimes.indexOf(d.gen_cat);
          crime_dict[u]["count"] = crime_dict[u]["count"] + 1;
          crime_dict[u][d.PdDistrict] = crime_dict[u][d.PdDistrict] + 1;
          var v = districts.indexOf(d.PdDistrict);
          district_dict[v]["count"] = district_dict[v]["count"] + 1;
          district_dict[v][d.gen_cat] = district_dict[v][d.gen_cat] + 1;
        });

        console.log("Crime Dict: ", crime_dict);
        console.log("Dist Dict: ", district_dict);
        
        var crime_bars = plot_crime.selectAll("rect")
          .data(crime_dict, function (d, i) { return d.gen_cat; })
          .enter();

        var x_crime_scale = d3.scale.linear()
          .domain([0, 5716])
          .range([0, plot_crime_width]);
        var y_crime_scale = d3.scale.linear()
          .domain([0, crimes.length])
          .range([0, plot_crime_height]);
        var y_crime = d3.scale.ordinal()
          .domain(crime_names)
          .rangeRoundBands([0, y_crime_scale(crimes.length)]);

        var xAxis_crime = d3.svg.axis()
          .scale(x_crime_scale)
          .orient("top")
          .ticks(5);
        var yAxis_crime = d3.svg.axis()
          .scale(y_crime)
          .orient("left")
          .ticks(0);

        crime_bars.append("rect")
          .attr("class", "crime_bars")
          .attr("x", 0)
          .attr("y", function (d, i) { return y_crime_scale(i + 0.1); })
          .attr("height", y_crime_scale(0.8))
          .attr("width", function (d, i) { return x_crime_scale(d.count); })
          .attr("fill", function (d, i) { return color(d.gen_cat); });
        console.log("Crime bars: ", crime_bars);
        console.log("First object:", crime_bars.length);

        plot_crime.append("g")
          .attr("class", "y axis")
          .call(yAxis_crime);
        plot_crime.append("g")
          .attr("class", "x axis")
          .call(xAxis_crime);

        var neighbor_bars = plot_hood.selectAll("rect")
          .data(district_dict, function (d, i) { return d.district; })
          .enter();

        var x_neighbor_scale = d3.scale.linear()
          .domain([0, 2614])
          .range([0, plot_hood_width]);
        var y_neighbor_scale = d3.scale.linear()
          .domain([0, districts.length])
          .range([0, plot_hood_height]);
        var y_neighbor = d3.scale.ordinal()
          .domain(districts)
          .rangeRoundBands([0, y_neighbor_scale(districts.length)]);

        neighbor_bars.append("rect")
          .attr("x", 0)
          .attr("y", function (d, i) { return y_neighbor_scale(i + 0.1); })
          .attr("height", y_neighbor_scale(0.8))
          .attr("width", function (d, i) { return x_neighbor_scale(d.count); })
          .attr("fill", "#66a61e");

        var xAxis_neighbor = d3.svg.axis()
          .scale(x_neighbor_scale)
          .orient("top");
        var yAxis_neighbor = d3.svg.axis()
          .scale(y_neighbor)
          .orient("left");

        plot_hood.append("g")
          .attr("class", "x axis")
          .call(xAxis_neighbor);
        plot_hood.append("g")
          .attr("class", "y axis")
          .call(yAxis_neighbor);

        var radius = 2;
        var circles = svg_map.append("g").selectAll("circle")
          .data(dataData)
          .enter();
        var tip = circles.append("g")
          .attr("class", "hovertext")
          .attr("x", 0)
          .attr("y", 0)
          .style("background-fill", "#99BEE3")
          .attr("font-size", "12px");
        circles.append("circle")
          .attr("class", "circles")
          .attr({
            r: 1.5*radius,
            cx: function (d, i) { return big_projection([d.X, d.Y])[0]; },
            cy: function (d, i) { return big_projection([d.X, d.Y])[1]; },
            id: function (d, i) { return d.IncidntNum; }
          })
          .style("fill", function (d, i) { return color(d.gen_cat); })
          .style("opacity", 0.3)
          .on("mouseover", function (d, i) {
            d3.select(this)
              .transition(duration)
              .attr("fill", "#0000FF")
              .attr("opacity", 1);
            tip.text(function (d, i) { return
              d.gen_cat + " in " + d.PdDistrict + 
              "</br>on " + d.Date + " at " + d.Time + 
              "</br>Description: " + d.Descript +
              "</br>Resolution: " + d.Resolution;
            });
          })
          .on("mouseout", function (d, i) {
            d3.select(this)
              .transition(duration)
              .attr("fill", function (d, i) { return color(d.gen_cat); })
              .attr("opacity", 0.3);
            tip.text(null);
          });
 
        dropDownNeighbor.on("change", function() {
          var selected = this.value;
          console.log("Selected: ", selected);
          displayOthers = this.checked ? "inline" : "none";
          console.log("DisplayOthers: ", displayOthers);
          display = this.checked ? "none" : "inline";
          console.log("Display: ", display);

          if (selected == 'All') {
            svg_map.selectAll(".circles")
                .attr("display", display);
            plot_crime.selectAll(".crime_bars")
                .attr("width", function (d, i) { return x_crime_scale(d.count); });
          }
          else {
            svg_map.selectAll(".circles")
                .filter(function(d) { return selected != d.PdDistrict; })
                .attr("display", displayOthers);
                
            svg_map.selectAll(".circles")
                .filter(function(d) { return selected == d.PdDistrict; })
                .attr("display", display);

            plot_crime.selectAll(".crime_bars")
                .attr("width", function (d, i) { return x_crime_scale(+d.selected); });
          }
        });
        var b;
        for (b in crimes) {
          var points = small_maps[b].selectAll("circle")
            .data(dataData, function (d, i) {
              if (d.gen_cat === crimes[b]) { return d.PdId; }
            })
            .enter();
          points.append("circle")
            .attr("r", radius)
            .attr("cx", function (d, i) { return small_projection([d.X, d.Y])[0]; })
            .attr("cy", function (d, i) { return small_projection([d.X, d.Y])[1]; })
            .attr("fill", function (d, i) { return color(d.gen_cat); })
            .attr("opacity", 0.2);
          small_maps[b].append("text")
            .attr("x", svg_smallmap_width)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .attr("font-size", "10px")
            .text(crime_name_dict[crimes[b]])
            .call(wrap, svg_smallmap_width);
        };
        var buttons = svg_smallmult.append("g").selectAll("rect")
            .data(crimes, function (d, i) { return crimes[i]; })
            .enter();
        buttons.append("rect")
            .attr("height", svg_smallmap_height)
            .attr("width", svg_smallmap_width)
            .attr("x", function (d, i) { return (i % 2) * (svg_smallmap_width + 15); })
            .attr("y", function (d, i) { return (i % 3) * (svg_smallmap_height + 15) + 80; })
            .style("fill", "#99BEE3")
            .attr("opacity", 0)
            .on("mouseover", function (d, i) {
              d3.select(this)
                .transition(duration)
                .attr("opacity", 0.2);
            })
            .on("mouseout", function (d, i) {
              d3.select(this)
                .transition(duration)
                .attr("opacity", 0);
            });
        log.text("Hover over visualizations for more information");
      });
    });

  var x_ts = d3.time.scale()
    .range([0, plot_ts_width]);

  var x_brush_ts = d3.time.scale()
    .range([0, plot_brush_width]);

  var y_brush_ts = d3.scale.linear()
    .domain([0, 245])
    .range([plot_brush_height, 0]);

  var y_ts = d3.scale.linear()
      .domain([0, 245])
      .range([plot_ts_height, 0]);

  var xAxis_ts = d3.svg.axis()
    .scale(x_ts)
    .orient("bottom");

  var xAxis_brush_ts = d3.svg.axis()
    .scale(x_brush_ts)
    .orient("bottom");

  var yAxis_ts = d3.svg.axis()
    .scale(y_ts)
    .orient("left");

  var yAxis_brush_ts = d3.svg.axis()
    .scale(y_brush_ts)
    .orient("left")
    .ticks(0);

  var brush = d3.svg.brush()
    .x(x_brush_ts)
    .on("brush", brushed);

  var line = d3.svg.line()
    .interpolate("basis")
    .x(function (d, i) { return x_ts(d.Date); })
    .y(function (d, i) { return y_ts(d.rate); })

  var line_brush = d3.svg.line()
    .interpolate("basis")
    .x(function (d, i) { return x_brush_ts(d.Date); })
    .y(function (d, i) { return y_brush_ts(d.rate); })

  d3.csv("data_files/sfpd_incidents_2014_ts_crime.csv", function (error, data) {
    data.forEach(function (d) {
      d.Date = date_format.parse(d.Date);
      d.Theft = + d.Theft;
      d.Other = + d.Other;
      d.Vandalism = + d.Vandalism;
      d.Assault = + d.Assault;
      d.Controlled = + d.Controlled;
      d.Kidnapping = + d.Kidnapping;
    });
    
    var time_domain = d3.extent(data, function (d, i) { return d.Date; });

    x_ts.domain(time_domain);
    x_brush_ts.domain(time_domain);

    var crime = color.domain().map(function (name) {
      return {
        name: name,
        values: data.map(function (d, i) {
          return {Date: d.Date, rate: +d[name]};
        })
      };
    });

    var crime_series = plot_ts.selectAll(".crime_series")
      .data(crime)
      .enter()
      .append("g")
      .attr("class", "crime_series");

    crime_series.append("path")
      .attr("class", "line")
      .attr("d", function (d, i) { return line(d.values); })
      .style("fill", "none")
      .style("stroke-width", "1.5px")
      .style("opacity", 0.8)
      .style("stroke", function (d, i) { return color(d.name); });

    var crime_brush = plot_brush.selectAll(".crime_brush")
      .data(crime)
      .enter()
      .append("g")
      .attr("class", "crime_brush");

    crime_brush.append("path")
      .attr("class", "line")
      .attr("d", function (d, i) { return line_brush(d.values); })
      .style("fill", "none")
      .style("stroke-width", "1.5px")
      .style("opacity", 0.8)
      .style("stroke", function (d, i) { return color(d.name); });

    plot_brush.append("g")
      .attr("class", "x brush")
      .call(brush)
      .selectAll("rect")
      .attr("y", -6)
      .attr("height", plot_brush_height + 7);

    plot_ts.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + plot_ts_height + ")")
      .call(xAxis_ts);

    plot_ts.append("g")
      .attr("class", "y axis")
      .call(yAxis_ts);

    plot_ts.append("text")
      .attr("transform", "translate(-28,0) rotate(-90)")
      .style("text-anchor", "end")
      .style("font-size", "10px")
      .style("font-weight", "bold")
      .text("Number of Crimes Committed");

    plot_brush.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + plot_brush_height + ")")
      .call(xAxis_brush_ts);

    plot_brush.append("g")
      .attr("class", "y axis")
      .call(yAxis_brush_ts);

  });

  function brushed() {
    x_ts.domain(brush.empty() ? x_brush_ts.domain() : brush.extent());
    plot_ts.selectAll(".line").attr("d", function (d, i) { return line(d.values); });
    plot_ts.select(".x.axis").call(xAxis_ts);
  };
  
</script>
</div>  
</div>
<div class="section">
    <div class="container">
      <h2 align="left">How the data is sorted</h2>
      <div class="row">
        <div class="col-sm-2">
          <h3 align="left">Theft</h3>
          <ul align="left">
            <li>Larceny/theft</li>
            <li>Vehicle theft</li>
            <li>Robbery</li>
            <li>Forgery/counterfeiting</li>
            <li>Stolen property</li>
            <li>Embezzlement</li>
            <li>Bad checks</li>
            <li>Extortion</li>
            <li>Bribery</li>
            <li>Burglary</li>
            <li>Fraud</li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h3 align="left">Controlled Substances/ Items</h3>
          <ul align="left">
            <li>Weapon laws</li>
            <li>Liquor laws</li>
            <li>Drug/narcotic</li>
            <li>Drunkenness</li>
            <li>Driving under the influence</li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h3 align="left">Disorderly Conduct</h3>
          <ul align="left">
            <li>Vandalism</li>
            <li>Suspicious occ.</li>
            <li>Loitering</li>
            <li>Disorderly conduct</li>
            <li>Tresspass</li>
            <li>Gambling</li>
            <li>Prostitution</li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h3 align="left">Violent Crime</h3>
          <ul align="left">
            <li>Arson</li>
            <li>Assault</li>
            <li>Suicide</li>
            <li>Sex offenses, forcible</li>
            <li>Sex offenses, non forcible</li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h3 align="left">Kidnapping</h3>
          <ul align="left">
            <li>Runaway</li>
            <li>Kidnapping</li>
            <li>Missing person</li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h3 align="left">Other</h3>
          <ul align="left">
            <li>Warrants</li>
            <li>Non-criminal</li>
            <li>Secondary codes</li>
            <li>Pornography/obscene mat.</li>
            <li>Family offenses</li>
            <li>Other offenses</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="container">
      <h2 align="left">Data-Preprocessing</h2>
      <p align="left">All data-preprocessing code can be found <a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/data_files/project.R">here</a>.</p>
    </div>
  </div>

  <div class="section">
    <div class="container">
      <h2 align="left">Discussion</h2>
      <h3 align="left">Techniques</h3>
      <h3 align="left">Interactivity</h3>
      <h3 align="left">Challenges</h3>
      <h3 align="left">Conclusion</h3>
    </div>
  </div>


</body>
</head>
</html>