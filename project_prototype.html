<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-quiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewpoint" content="width=device-width, initial-scale=1">

  <title>Project Prototype</title>
  
  <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
  <link rel="stylesheet" href="stylesheets/main.css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <style type="text/css">
  .brush .extent {
    stroke: #fff;
    fill-opacity: .125;
    shape-rendering: crispEdges;
  }
  </style>
</head>
<body align="center">

<!--NAVIGATIONBAR-->
  <div class="nav">
    <div class="container">
      <div class="row">
        <div class="col-md-0">
        <ul class="pull-left">
          <li><a href="http://MichaelaHull.github.io#homework">Homework</a></li>
          <li><a href="http://MichaelaHull.github.io#projects">Projects</a></li>
          <li><a href="http://MichaelaHull.github.io#participation">Participation</a></li>
        </ul>
        </div>
        <div class="col-md-0">
        <ul class="pull-right">
          <li><a href="http://MichaelaHull.github.io#about">About</a></li>
          <li><a href="http://MichaelaHull.github.io#contact">Contact</a></li>
          <li><a href="http://MichaelaHull.github.io">Home</a></li>
        </ul>
        </div>
      </div>
    </div>
  </div>

<!--BANNER-->
  <div class="banner">
    <div class="container">
      <h1>Michaela Hull: Project Prototype</h1>
      <ul class="pull-right">
      	<li><a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/project_prototype.html">Code</a></li>
      	<li><a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/data_files/sfpd_incidents_2014.csv">Data</a></li>
      </ul>
    </div>
  </div>

  <div class="section">
  <div class="container">
  <script type="text/javascript">
  var baseURL = "https://gist.githubusercontent.com/mbostock/4090846/raw/"

  var svg_ts_height = 400;
  var svg_ts_width = 900;
  var margin = 30;
  var lab_margin = 80;
  var svg_map_height = 400;
  var svg_map_width = 510;
  var svg_var_height = svg_map_height;
  var svg_var_width = svg_ts_width - svg_map_width;
  var svg_crime_height = 250;
  var svg_crime_width = svg_ts_width/2;
  var svg_hood_height = svg_crime_height;
  var svg_hood_width = svg_crime_width;
  var svg_brush_height = 100;
  var svg_brush_width = svg_ts_width;

  var plot_ts_height = svg_ts_height - 2*margin;
  var plot_ts_width = svg_ts_width - margin - lab_margin;
  var plot_map_height = svg_map_height - 2*margin;
  var plot_map_width = svg_map_width - 2*margin;
  var plot_crime_height = svg_crime_height - 2*margin;
  var plot_crime_width = svg_crime_width - 2*lab_margin - margin;
  var plot_hood_height = svg_hood_height - 2*margin;
  var plot_hood_width = svg_hood_width - lab_margin - margin;
  var plot_var_height = svg_var_height - 2*margin;
  var plot_var_width = svg_var_width - 2*margin;
  var plot_brush_height = svg_brush_height - 2*margin;
  var plot_brush_width = plot_ts_width;

  var svg_map = d3.select("body").append("svg")
  	.attr("height", svg_map_height)
  	.attr("width", svg_map_width)
  	.style("border-width", "1px")
  	.style("border-fill", "black")
  	.style("border-style", "solid");

  var plot_map = svg_map.append("g")
  	.attr("transform", "translate(" + margin + "," + margin + ")");

  var svg_var = d3.select("body").append("svg")
  	.attr("height", svg_var_height)
  	.attr("width", svg_var_width)
  	.style("border-width", "1px")
  	.style("border-fill", "black")
  	.style("border-style", "solid");

  var plot_var = svg_var.append("g")
  	.attr("transform", "translate(" + margin + "," + margin + ")");

  var svg_crime = d3.select("body").append("svg")
    .attr("height", svg_crime_height)
    .attr("width", svg_crime_width)
    .style("border-width", "1px")
    .style("border-fill", "black")
    .style("border-style", "solid");

  var plot_crime = svg_crime.append("g")
    .attr("transform", "translate(" + 2*lab_margin + "," + margin + ")");


  var svg_hood = d3.select("body").append("svg")
    .attr("height", svg_hood_height)
    .attr("width", svg_hood_width)
    .style("border-width", "1px")
    .style("border-fill", "black")
    .style("border-style", "solid");

  var plot_hood = svg_hood.append("g")
    .attr("transform", "translate(" + lab_margin + "," + margin + ")");

  var svg_ts = d3.select("body").append("svg")
  	.attr("height", svg_ts_height)
  	.attr("width", svg_ts_width)
  	.style("border-width", "1px")
  	.style("border-fill", "black")
  	.style("border-style", "solid");

  var plot_ts = svg_ts.append("g")
  	.attr("transform", "translate(" + lab_margin + "," + margin + ")");

  var svg_brush = d3.select("body").append("svg")
  	.attr("height", svg_brush_height)
  	.attr("width", svg_brush_width)
  	.style("border-width", "1px")
  	.style("border-fill", "black")
  	.style("border-style", "solid");

  var plot_brush = svg_brush.append("g")
  	.attr("transform", "translate(" + lab_margin + "," + margin + ")");

  // Working on making a map of San Francisco

//   var projection = d3.geo.albersUsa()
//     .scale(1000)
//     .translate([plot_map_width / 2, plot_map_height / 2]);

//   var projection = d3.geo.albers()
// //    .center([0, -122.439441393979])
// //    .rotate([37.763948697877794, 0])
//     .parallels([50, 60])
//     .scale(1000)
//     .translate([plot_map_width / 2, plot_map_height / 2]);

//   var path = d3.geo.path()
//     .projection(projection);  

//   d3.json(baseURL + 'us.json', function (error, us) {
//     plot_map.insert("path", ".graticule")
//       .datum(topojson.feature(us, us.objects.land))
//       .attr("class", "land")
//       .attr("fill", "#ddc")
//       .attr("d", path)
//   });

  var color_ref = {
  	"Other": "#e6ab02",
  	"Theft": "#7570b3",
  	"Controlled": "#d95f02",
  	"Assault": "#e7298a",
  	"Kidnapping": "#66a61e",
  	"Vandalism": "#1b9e77"
  };

  var colors = {
    "grey":   "#bbbbbb",
    "blue":   "#4D4D94",
    "purple": "#A37ACC",
    "green":  "#33AD5C",
    "orange": "#CCA300"
  };

  var districts = ["Southern", "Mission", "Northern", "Central", "Bayview", "Ingleside", "Tenderloin", "Taraval", "Park", "Richmond"];

  var crimes = ["Theft", "Other", "Vandalism", "Assault", "Controlled", "Kidnapping"];

  var crime_names = ["Theft", "Other", "Disorderly Conduct", "Violent Crime", "Controlled Substances/Items", "Kidnapping"];

  var crime_dict = [];

  var district_dict = [];

  function count_start(keys, dict, thing) {
  	var k;
  	for (k in keys) {
  		var u = {};
  		u[thing] = keys[k];
  		u["count"] = 0;
  		dict.push(u);
  	};
  };

  count_start(districts, district_dict, "district");
  count_start(crimes, crime_dict, "gen_cat");

  var date_format = d3.time.format("%m/%d/%Y");
  var date_time = d3.time.format("%Y-%m-%d %H:%M:%S")

  var color = d3.scale.ordinal()
    .domain(crimes)
    .range(["#e6ab02", "#7570b3", "#d95f02", "#e7298a", "#66a61e", "#1b9e77"]);

  d3.csv("data_files/sfpd_incidents_2014.csv", function (error, data) {
  	data.forEach(function (d) {
  	  d.IncidntNum = d.IncidntNum;
  	  d.Category = d.Category;
  	  d.Descript = d.Descript;
  	  d.DayOfWeek = d.DayOfWeek;
  	  d.Date = date_format.parse(d.Date);
  	  d.Time = d.Time;
  	  d.PdDistrict = d.PdDistrict;
  	  d.Resolution = d.Resolution;
  	  d.X = + d.X;
  	  d.Y = + d.Y;
  	  d.gen_cat = d.gen_cat;
  	  d.datetime = date_time.parse(d.datetime);
  	  var u = districts.indexOf(d.PdDistrict);
  	  district_dict[u]["count"] = district_dict[u]["count"] + 1;
      var v = crimes.indexOf(d.gen_cat);
      crime_dict[v]["count"] = crime_dict[v]["count"] + 1;
  	});
  	var x_freq = d3.scale.linear()
  		.domain([0, 28871])
  		.range([0, plot_hood_width]);
  	var y_freq_scale = d3.scale.linear()
  		.domain([0, districts.length])
  		.range([0, plot_hood_height]);
  	var y_freq = d3.scale.ordinal()
  		.domain(districts)
  		.rangeRoundBands([0, y_freq_scale(districts.length)]);

  	var xAxis_freq = d3.svg.axis()
  		.scale(x_freq)
  		.orient("top");

  	var yAxis_freq = d3.svg.axis()
  		.scale(y_freq)
  		.orient("left")
  		.ticks(0);

  	var boxes = plot_hood.selectAll("rect")
  		.data(district_dict, function (d) {
  			return d.district;
  		})
  		.enter();
  	boxes.append("rect")
  		.attr("y", function (d, i) { return y_freq_scale(i + 0.1); })
  		.attr("x", 0)
  		.attr("height", y_freq_scale(0.8))
  		.attr("width", function (d, i) { return x_freq(+d.count); })
  		.attr("fill", "#4D4D94")
  		.attr("opacity", 0.9);

  	plot_hood.append("g")
  		.attr("class", "y axis")
  		.call(yAxis_freq);

  	plot_hood.append("g")
  		.attr("class", "x axis")
  		.call(xAxis_freq);

    var x_crime = d3.scale.linear()
      .domain([0, 59717])
      .range([0, plot_crime_width]);
    var y_crime_scale = d3.scale.linear()
      .domain([0, crimes.length])
      .range([0, plot_crime_height]);
    var y_crime = d3.scale.ordinal()
      .domain(crime_names)
      .rangeRoundBands([0, y_crime_scale(crimes.length)]);

    var xAxis_crime = d3.svg.axis()
      .scale(x_crime)
      .orient("top")
      .ticks(6);

    var yAxis_crime = d3.svg.axis()
      .scale(y_crime)
      .orient("left")
      .ticks(0);

    var bars = plot_crime.selectAll("rect")
      .data(crime_dict, function (d) {
        return d.gen_cat;
      })
      .enter();
    bars.append("rect")
      .attr("y", function (d, i) { return y_crime_scale(i + 0.1); })
      .attr("x", 0)
      .attr("height", y_crime_scale(0.8))
      .attr("width", function (d, i) { return x_crime(+d.count); })
      .attr("fill", function (d, i) { return color(d.gen_cat); })
      .attr("opacity", 0.7);

    plot_crime.append("g")
      .attr("class", "x axis")
      .call(xAxis_crime);

    plot_crime.append("g")
      .attr("class", "y axis")
      .call(yAxis_crime);


  	var x_map_domain = d3.extent(data, function (d) { return d.X; });
  	var y_map_domain = d3.extent(data, function (d) { return d.Y; });
    console.log('map x domain:', x_map_domain);
    console.log('map y domain:', y_map_domain);
  	var x_map = d3.scale.linear()
  		.domain(x_map_domain)
  		.range([0, plot_map_width]);
  	var y_map = d3.scale.linear()
  		.domain(y_map_domain)
  		.range([plot_map_height, 0]);
  	var radius = 2;

  	var dots = plot_map.selectAll("circle")
  		.data(data, function (d, i) {
  			return d.PdId;
  		})
  		.enter();
  	dots.append("circle")
  		.attr("r", radius)
  		.attr("cx", function (d, i) { return x_map(d.X); })
  		.attr("cy", function (d, i) { return y_map(d.Y); })
  		.attr("fill", function (d, i) { return color(d.gen_cat); })
  		.attr("opacity", 0.2);

  });

  function line_plot(variable, plotspace, data, xscale, yscale) {
    line.x(function (d, i) { return xscale(d.Date)})
      .y(function (d, i) { return yscale(d[variable])});
    plotspace.append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line)
      .attr("fill", "none")
      .attr("stroke", function (d, i) { return color_ref[variable]; })
      .attr("stroke-width", "1.5px");
  };

  var x_ts = d3.time.scale()
    .range([0, plot_ts_width]);

  var x_brush_ts = d3.time.scale()
    .range([0, plot_brush_width]);

  var y_brush_ts = d3.scale.linear()
    .domain([0, 245])
    .range([plot_brush_height, 0]);

  var y_ts = d3.scale.linear()
      .domain([0, 245])
      .range([plot_ts_height, 0]);

  var xAxis_ts = d3.svg.axis()
    .scale(x_ts)
    .orient("bottom");

  var xAxis_brush_ts = d3.svg.axis()
    .scale(x_brush_ts)
    .orient("bottom");

  var yAxis_ts = d3.svg.axis()
    .scale(y_ts)
    .orient("left");

  var yAxis_brush_ts = d3.svg.axis()
    .scale(y_brush_ts)
    .orient("left")
    .ticks(1);

  var brush = d3.svg.brush()
    .x(x_brush_ts)
    .on("brush", brushed);

  var line = d3.svg.line()
    .interpolate("basis")
    .x(function (d, i) { return x_ts(d.Date); })
    .y(function (d, i) { return y_ts(d.rate); })

  var line_brush = d3.svg.line()
    .interpolate("basis")
    .x(function (d, i) { return x_brush_ts(d.Date); })
    .y(function (d, i) { return y_brush_ts(d.rate); })


  d3.csv("data_files/sfpd_incidents_2014_ts_crime.csv", function (error, data) {
    data.forEach(function (d) {
      d.Date = date_format.parse(d.Date);
      d.Theft = + d.Theft;
      d.Other = + d.Other;
      d.Vandalism = + d.Vandalism;
      d.Assault = + d.Assault;
      d.Controlled = + d.Controlled;
      d.Kidnapping = + d.Kidnapping;
    });
    
    var time_domain = d3.extent(data, function (d, i) { return d.Date; });

    x_ts.domain(time_domain);
    x_brush_ts.domain(time_domain);

    var crime = color.domain().map(function (name) {
      return {
        name: name,
        values: data.map(function (d, i) {
          return {Date: d.Date, rate: +d[name]};
        })
      };
    });
    console.log("Crime", crime);

    var crime_series = plot_ts.selectAll(".crime_series")
      .data(crime)
      .enter()
      .append("g")
      .attr("class", "crime_series");

    crime_series.append("path")
      .attr("class", "line")
      .attr("d", function (d, i) { return line(d.values); })
      .style("fill", "none")
      .style("stroke-width", "1.5px")
      .style("opacity", 0.8)
      .style("stroke", function (d, i) { return color(d.name); });

    var crime_brush = plot_brush.selectAll(".crime_brush")
      .data(crime)
      .enter()
      .append("g")
      .attr("class", "crime_brush");

    crime_brush.append("path")
      .attr("class", "line")
      .attr("d", function (d, i) { return line_brush(d.values); })
      .style("fill", "none")
      .style("stroke-width", "1.5px")
      .style("opacity", 0.8)
      .style("stroke", function (d, i) { return color(d.name); });

    plot_brush.append("g")
      .attr("class", "x brush")
      .call(brush)
      .selectAll("rect")
      .attr("y", -6)
      .attr("height", plot_brush_height + 7);

    plot_ts.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + plot_ts_height + ")")
      .call(xAxis_ts);

    plot_ts.append("g")
      .attr("class", "y axis")
      .call(yAxis_ts);

    plot_brush.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + plot_brush_height + ")")
      .call(xAxis_brush_ts);

    plot_brush.append("g")
      .attr("class", "y axis")
      .call(yAxis_brush_ts);

  });

  function brushed() {
    x_ts.domain(brush.empty() ? x_brush_ts.domain() : brush.extent());
    plot_ts.select(".line").attr("d", function (d, i) { return line(d.values); });
    plot_ts.select(".x.axis").call(xAxis_ts);
  };

  </script>	
  </div>
  </div>
  <div class="section">
  	<div class="container">
  		<h2 align="left">Data-Preprocessing</h2>
  		<p align="left">All data-preprocessing code can be found <a href="https://github.com/MichaelaHull/MichaelaHull.github.io/blob/master/data_files/project.R">here</a>.</p>
  	</div>
  </div>

</body>
</head>
</html>